/**
 * @title WET-BOEW variant of Starcounter-Jack/JSON-Patch
 * @overview Same as json-patch.js but added extensibility support, changed the behaviour of patch test to be atomic and code was fully eslinted.
 * @license MIT
 * @author @duboisp @Starcounter-Jack
 *
 * ----
 *
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 1.1.4
 * (c) 2013 Joachim Wester
 * MIT license
 */
var jsonpatch;!function(a){var b,c=function(a){if(b(a)){for(var c=new Array(a.length),d=0;d<c.length;d++)c[d]=""+d;return c}if(Object.keys)return Object.keys(a);var c=[];for(var e in a)a.hasOwnProperty(e)&&c.push(e);return c},d=function(a,e){switch(typeof a){case"undefined":case"boolean":case"string":case"number":return a===e;case"object":if(null===a)return null===e;if(b(a)){if(!b(e)||a.length!==e.length)return!1;for(var f=0,g=a.length;f<g;f++)if(!d(a[f],e[f]))return!1;return!0}var h=c(e),i=h.length;if(c(a).length!==i)return!1;for(var f=0;f<i;f++)if(!d(a[f],e[f]))return!1;return!0;default:return!1}},e={add:function(a,b){a[b]=this.value},remove:function(a,b){var c=a[b];return delete a[b],c},replace:function(a,b){var c=a[b];return a[b]=this.value,c},move:function(a,b,c){var d={op:"_get",path:this.path};h(c,[d]);var e=void 0===d.value?void 0:JSON.parse(JSON.stringify(d.value)),f={op:"_get",path:this.from};return h(c,[f]),h(c,[{op:"remove",path:this.from}]),h(c,[{op:"add",path:this.path,value:f.value}]),e},copy:function(a,b,c){var d={op:"_get",path:this.from};h(c,[d]),h(c,[{op:"add",path:this.path,value:d.value}])},test:function(a,b){return d(a[b],this.value)},_get:function(a,b){this.value=a[b]}},f={add:function(a,b){return a.splice(b,0,this.value),b},remove:function(a,b){return a.splice(b,1)[0]},replace:function(a,b){var c=a[b];return a[b]=this.value,c},move:e.move,copy:e.copy,test:e.test,_get:e._get},g={add:function(a){g.remove.call(this,a);for(var b in this.value)this.value.hasOwnProperty(b)&&(a[b]=this.value[b])},remove:function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b],e.remove.call(this,a,b));return c},replace:function(a){var b=h(a,[{op:"remove",path:this.path}]);return h(a,[{op:"add",path:this.path,value:this.value}]),b[0]},move:e.move,copy:e.copy,test:function(a){return JSON.stringify(a)===JSON.stringify(this.value)},_get:function(a){this.value=a}},h=function(a,c,d){d||c.sort(function(a,b){return"test"===a.op&&"test"!==b.op?-1:"test"===b.op?1:0});for(var h,i,j=new Array(c.length),k=0,l=c.length;k<l;){h=c[k],k+=1;for(var m=h.path||"",n=h.op,o=!d&&"test"===n,p=m.split("/"),q=a,r=1,s=p.length;q;){if(i=p[r],r+=1,void 0===i&&r>=s){if(j[k-1]=g[n].call(h,q,i,a),o&&!j[k-1])return a;break}if(b(q)){if(i="-"===i?q.length:parseInt(i,10),r>=s){if(j[k-1]=f[n].call(h,q,i,a),o&&!j[k-1])return a;break}}else if(i&&-1!==i.indexOf("~")&&(i=i.replace(/~1/g,"/").replace(/~0/g,"~")),r>=s){if(j[k-1]=e[n].call(h,q,i,a),o&&!j[k-1])return a;break}q=q[i]}}return j},i=function(a,b){if(e[a])throw"The operation "+a+" already registered.";e[a]=b},j=function(a,b){if(f[a])throw"The operation "+a+" already registered.";f[a]=b},k=function(a,b){if(g[a])throw"The operation "+a+" already registered.";g[a]=b};b=Array.isArray?Array.isArray:function(a){return a.push&&"number"==typeof a.length},a.apply=h,a.registerOps=i,a.registerOpsArray=j,a.registerOpsRoot=k}(jsonpatch||(jsonpatch={}));